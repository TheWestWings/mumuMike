<!-- pages/user/user.wxml - ä¸ªäººä¸­å¿ƒé¡µ -->
<view class="container">
  <!-- ç”¨æˆ·ä¿¡æ¯å¤´éƒ¨ -->
  <view class="user-header">
    <view class="user-bg"></view>
    <view class="user-info" wx:if="{{isLoggedIn}}">
      <view class="avatar-wrapper">
        <image 
          class="avatar" 
          src="{{userInfo.avatar || '/images/default-avatar.png'}}"
          mode="aspectFill"
        ></image>
      </view>
      <text class="username">{{userInfo.username || 'ç”¨æˆ·'}}</text>
      <text class="user-phone" wx:if="{{userInfo.phone}}">{{userInfo.phone}}</text>
    </view>
    <view class="user-info" wx:else>
      <view class="avatar-wrapper" bindtap="goToLogin">
        <view class="avatar default">
          <text>ğŸ‘¤</text>
        </view>
      </view>
      <text class="username" bindtap="goToLogin">ç‚¹å‡»ç™»å½•</text>
      <text class="user-phone">ç™»å½•åäº«å—æ›´å¤šæœåŠ¡</text>
    </view>
  </view>

  <!-- åŠŸèƒ½èœå• -->
  <view class="menu-section">
    <view class="menu-group">
      <view class="menu-item" bindtap="goToOrders">
        <view class="menu-icon">ğŸ“‹</view>
        <text class="menu-text">æˆ‘çš„è®¢å•</text>
        <text class="menu-arrow">â€º</text>
      </view>
      <view class="menu-item" bindtap="goToMessages">
        <view class="menu-icon">ğŸ””</view>
        <text class="menu-text">æ¶ˆæ¯é€šçŸ¥</text>
        <view class="menu-badge" wx:if="{{unreadCount > 0}}">{{unreadCount}}</view>
        <text class="menu-arrow">â€º</text>
      </view>
    </view>

    <view class="menu-group">
      <view class="menu-item" bindtap="goToFeedback">
        <view class="menu-icon">âœï¸</view>
        <text class="menu-text">æ„è§åé¦ˆ</text>
        <text class="menu-arrow">â€º</text>
      </view>
      <view class="menu-item" bindtap="scanQRCode">
        <view class="menu-icon">ğŸ“·</view>
        <text class="menu-text">æ‰«ç ç‚¹é¤</text>
        <text class="menu-arrow">â€º</text>
      </view>
    </view>

    <view class="menu-group">
      <view class="menu-item" bindtap="showAbout">
        <view class="menu-icon">â„¹ï¸</view>
        <text class="menu-text">å…³äºæˆ‘ä»¬</text>
        <text class="menu-arrow">â€º</text>
      </view>
      <view class="menu-item" bindtap="contactService">
        <view class="menu-icon">ğŸ“</view>
        <text class="menu-text">è”ç³»å®¢æœ</text>
        <text class="menu-arrow">â€º</text>
      </view>
    </view>
  </view>

  <!-- é€€å‡ºç™»å½• -->
  <view class="logout-section" wx:if="{{isLoggedIn}}">
    <button class="logout-btn" bindtap="logout">é€€å‡ºç™»å½•</button>
  </view>

  <!-- ç‰ˆæƒä¿¡æ¯ -->
  <view class="footer">
    <text>æœ¨æœ¨å¥¶èŒ¶ v1.0.0</text>
  </view>
</view>

<!-- æ¶ˆæ¯åˆ—è¡¨å¼¹çª— -->
<view class="message-modal" wx:if="{{showMessages}}">
  <view class="modal-mask" bindtap="closeMessages"></view>
  <view class="modal-content">
    <view class="modal-header">
      <text class="modal-title">æ¶ˆæ¯é€šçŸ¥</text>
      <view class="modal-close" bindtap="closeMessages">Ã—</view>
    </view>
    <scroll-view class="message-list" scroll-y>
      <view 
        class="message-item unread"
        wx:for="{{messageList}}"
        wx:if="{{item.status === 0}}"
        wx:key="id"
        bindtap="readMessage"
        data-index="{{index}}"
      >
        <view class="message-header">
          <text class="message-title">{{item.title}}</text>
          <text class="message-time">{{item.createTime}}</text>
        </view>
        <text class="message-content">{{item.content}}</text>
      </view>
      <view class="empty-message" wx:if="{{unreadCount === 0}}">
        <text>æš‚æ— æœªè¯»æ¶ˆæ¯</text>
      </view>
    </scroll-view>
  </view>
</view>
