<!-- pages/order/order.wxml - è®¢å•åˆ—è¡¨é¡µ -->
<view class="container">
  <!-- å¤´éƒ¨æ ‡ç­¾ -->
  <view class="tabs">
    <view 
      class="tab-item {{currentTab === 0 ? 'active' : ''}}"
      data-tab="0"
      bindtap="switchTab"
    >
      <text>è¿›è¡Œä¸­</text>
      <view class="tab-line" wx:if="{{currentTab === 0}}"></view>
    </view>
    <view 
      class="tab-item {{currentTab === 1 ? 'active' : ''}}"
      data-tab="1"
      bindtap="switchTab"
    >
      <text>å·²å®Œæˆ</text>
      <view class="tab-line" wx:if="{{currentTab === 1}}"></view>
    </view>
  </view>

  <!-- è®¢å•åˆ—è¡¨ -->
  <scroll-view 
    class="order-list" 
    scroll-y 
    refresher-enabled
    refresher-triggered="{{refreshing}}"
    bindrefresherrefresh="onRefresh"
  >
    <view wx:if="{{orderList.length > 0}}">
      <view 
        class="order-card" 
        wx:for="{{orderList}}" 
        wx:key="id"
        bindtap="goToDetail"
        data-id="{{item.id}}"
      >
        <!-- è®¢å•å¤´éƒ¨ -->
        <view class="order-header">
          <text class="order-no">è®¢å•å·: {{item.id}}</text>
          <text class="order-status status-{{item.status}}">{{item.statusText}}</text>
        </view>

        <!-- è®¢å•å•†å“ -->
        <view class="order-products">
          <view 
            class="product-item"
            wx:for="{{item.product}}"
            wx:for-item="product"
            wx:key="id"
          >
            <image class="product-image" src="{{product.product.pictureUrl}}" mode="aspectFill"></image>
            <view class="product-info">
              <text class="product-name">{{product.product.name}}</text>
              <text class="product-count">x{{product.count}}</text>
            </view>
            <text class="product-price">Â¥{{product.product.price}}</text>
          </view>
        </view>

        <!-- è®¢å•åº•éƒ¨ -->
        <view class="order-footer">
          <view class="order-time">
            <text>{{item.createTimeText}}</text>
          </view>
          <view class="order-total">
            <text class="total-label">åˆè®¡ï¼š</text>
            <text class="total-price">Â¥{{item.totalPrice}}</text>
          </view>
        </view>

        <!-- æ“ä½œæŒ‰é’® -->
        <view class="order-actions" wx:if="{{item.status === 2 && item.reviewed !== 1}}">
          <button class="action-btn" data-id="{{item.id}}" catchtap="goToReview">
            è¯„ä»·
          </button>
        </view>
        <view class="order-actions" wx:if="{{item.status === 2 && item.reviewed === 1}}">
          <button class="action-btn disabled" disabled>
            å·²è¯„ä»·
          </button>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:else>
      <text class="empty-icon">ğŸ“‹</text>
      <text class="empty-text">æš‚æ— è®¢å•</text>
      <text class="empty-hint">å¿«å»ç‚¹æ¯å¥¶èŒ¶å§~</text>
      <button class="go-order-btn" bindtap="goToMenu">å»ç‚¹é¤</button>
    </view>

    <view class="bottom-space"></view>
  </scroll-view>
</view>
