<!-- pages/menu/menu.wxml - èœå•ç‚¹é¤é¡µ -->
<view class="container">
  <!-- å¤´éƒ¨ä¿¡æ¯ -->
  <view class="header">
    <view class="header-content">
      <text class="title">æœ¨æœ¨å¥¶èŒ¶</text>
      <text class="subtitle">ç”¨å¿ƒåˆ¶ä½œçš„å¥¶é¦™ç”œå“</text>
    </view>
    <view class="table-badge" wx:if="{{tableNo}}">
      <text>æ¡Œå· {{tableNo}}</text>
    </view>
  </view>

  <!-- ä¸»ä½“å†…å®¹åŒº -->
  <view class="main-content">
    <!-- å·¦ä¾§åˆ†ç±»å¯¼èˆª -->
    <scroll-view class="category-nav" scroll-y enhanced show-scrollbar="{{false}}">
      <view 
        class="category-item {{currentCategory === index ? 'active' : ''}}"
        wx:for="{{categoryList}}"
        wx:key="id"
        data-index="{{index}}"
        bindtap="switchCategory"
      >
        <text class="category-name">{{item.title}}</text>
        <view class="category-indicator" wx:if="{{currentCategory === index}}"></view>
      </view>
    </scroll-view>

    <!-- å³ä¾§å•†å“åˆ—è¡¨ -->
    <scroll-view 
      class="product-list" 
      scroll-y 
      enhanced 
      show-scrollbar="{{false}}"
      scroll-into-view="{{scrollToView}}"
      bindscroll="onProductScroll"
    >
      <view wx:for="{{categoryList}}" wx:key="id" id="category-{{index}}">
        <!-- åˆ†ç±»æ ‡é¢˜ -->
        <view class="category-header">
          <text class="category-title">{{item.title}}</text>
          <text class="category-desc">{{item.description}}</text>
        </view>
        
        <!-- å•†å“å¡ç‰‡ -->
        <view 
          class="product-card"
          wx:for="{{item.productList}}"
          wx:for-item="product"
          wx:key="id"
        >
          <image 
            class="product-image" 
            src="{{product.pictureUrl}}" 
            mode="aspectFill"
            lazy-load
          ></image>
          <view class="product-info">
            <text class="product-name">{{product.name}}</text>
            <text class="product-desc">{{product.description}}</text>
            <view class="product-bottom">
              <text class="product-price">Â¥{{product.price}}</text>
              <view class="product-actions">
                <view 
                  class="count-btn minus" 
                  wx:if="{{cartCountMap[product.id] > 0}}"
                  data-product="{{product}}"
                  catchtap="decreaseCount"
                >
                  <text>-</text>
                </view>
                <text class="count-num" wx:if="{{cartCountMap[product.id] > 0}}">
                  {{cartCountMap[product.id]}}
                </text>
                <view 
                  class="count-btn plus"
                  data-product="{{product}}"
                  catchtap="increaseCount"
                >
                  <text>+</text>
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>
      
      <!-- åº•éƒ¨ç•™ç™½ -->
      <view class="bottom-space"></view>
    </scroll-view>
  </view>

  <!-- åº•éƒ¨è´­ç‰©è½¦æ  -->
  <view class="cart-bar" wx:if="{{cartCount > 0}}">
    <view class="cart-info" bindtap="toggleCartDrawer">
      <view class="cart-icon-wrapper">
        <text class="cart-icon">ğŸ›’</text>
        <view class="cart-badge">{{cartCount}}</view>
      </view>
      <view class="cart-price-info">
        <text class="cart-total">Â¥{{cartTotal}}</text>
        <text class="cart-hint">å·²é€‰ {{cartCount}} ä»¶</text>
      </view>
    </view>
    <button class="checkout-btn" bindtap="goToCheckout">
      <text>å»ç»“ç®—</text>
    </button>
  </view>

  <!-- ç©ºçŠ¶æ€åº•éƒ¨è´­ç‰©è½¦ -->
  <view class="cart-bar empty" wx:else>
    <view class="cart-info">
      <view class="cart-icon-wrapper">
        <text class="cart-icon">ğŸ›’</text>
      </view>
      <text class="empty-hint">è´­ç‰©è½¦æ˜¯ç©ºçš„</text>
    </view>
  </view>
</view>

<!-- è´­ç‰©è½¦æŠ½å±‰ -->
<view class="cart-drawer-mask" wx:if="{{showCartDrawer}}" bindtap="closeCartDrawer"></view>
<view class="cart-drawer {{showCartDrawer ? 'show' : ''}}">
  <view class="drawer-header">
    <text class="drawer-title">è´­ç‰©è½¦</text>
    <view class="drawer-clear" bindtap="clearCart">
      <text>æ¸…ç©º</text>
    </view>
  </view>
  <scroll-view class="drawer-content" scroll-y>
    <view class="drawer-item" wx:for="{{cartList}}" wx:key="index">
      <view class="drawer-item-info">
        <text class="drawer-item-name">{{item.name}}</text>
        <text class="drawer-item-price">Â¥{{item.price}}</text>
      </view>
      <view class="drawer-item-actions">
        <view class="drawer-btn minus" data-index="{{index}}" catchtap="decreaseCartItem">
          <text>-</text>
        </view>
        <text class="drawer-item-count">{{item.count}}</text>
        <view class="drawer-btn plus" data-index="{{index}}" catchtap="increaseCartItem">
          <text>+</text>
        </view>
      </view>
    </view>
    <view class="drawer-empty" wx:if="{{cartList.length === 0}}">
      <text>è´­ç‰©è½¦æ˜¯ç©ºçš„</text>
    </view>
  </scroll-view>
  <view class="drawer-footer">
    <view class="drawer-total">
      <text>åˆè®¡ï¼š</text>
      <text class="drawer-total-price">Â¥{{cartTotal}}</text>
    </view>
    <button class="drawer-checkout-btn" bindtap="goToCheckout">å»ç»“ç®—</button>
  </view>
</view>

<!-- è§„æ ¼é€‰æ‹©å¼¹çª—ï¼ˆé¢„ç•™ï¼‰ -->
<view class="spec-modal" wx:if="{{showSpecModal}}">
  <view class="modal-mask" bindtap="closeSpecModal"></view>
  <view class="modal-content">
    <view class="modal-header">
      <text class="modal-title">{{currentProduct.name}}</text>
      <view class="modal-close" bindtap="closeSpecModal">Ã—</view>
    </view>
    <view class="modal-body">
      <!-- å¤‡æ³¨è¾“å…¥ -->
      <view class="remark-section">
        <text class="remark-label">å¤‡æ³¨</text>
        <input 
          class="remark-input" 
          placeholder="è¯·è¾“å…¥ç‰¹æ®Šè¦æ±‚"
          value="{{productRemark}}"
          bindinput="onRemarkInput"
        />
      </view>
    </view>
    <view class="modal-footer">
      <button class="modal-btn" bindtap="confirmAddToCart">
        åŠ å…¥è´­ç‰©è½¦
      </button>
    </view>
  </view>
</view>
